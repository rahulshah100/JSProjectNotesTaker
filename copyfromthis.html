<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Notes App</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <style>
    #aboutus {
      cursor: pointer;
    }

    #modebtn:hover {
      border-radius: 10px 10px;
      box-shadow: 2px 2px 5px 3px #888888;
      cursor: pointer;
    }

    .darktheme {
      background-color: rgb(29, 28, 28);
    }

    .darkcolor {
      color: white;
    }
  </style>
</head>

<body onload="modeconf()">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Notes Taker</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" id="aboutus" data-toggle="modal" data-target="#myModal"> About Us </a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" id="aboutus" data-toggle="modal" data-target="#myModal2"> Contact Us </a>
        </li>
      </ul>
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" id="searchTxt" type="search" placeholder="Your Note's Content"
          aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit" id="search">Search</button>
      </form>
    </div>
  </nav>

  <!-- success message -->
  <div id="addednotes"></div>

  <div class="container pt-5 my-2">
    <h1 class="d-inline" id="Welcome">
      <span>Welcome To Notes Taker</span>
      <img type="button" src="dark.png" class="float-right" id="modebtn" width="5%" onclick="modechange()">
    </h1>


    <div class="card w-75 p-2 my-4">
      <div class="form-group">
        <h5 class="card-title mx-2 my-3 mx-4"> Add a title</h5>
        <input type="text" class="mx-3 form-control addTitle" id="addTitle" style="width: 90%;"
          placeholder="Add a Title Here">
      </div>

      <div class="card-body">
        <h5 class="card-title">Add a note</h5>
        <div class="form-group">
          <textarea class="form-control" id="addTxt" rows="2" placeholder="Add Description Here"></textarea>
        </div>
        <button class="btn btn-primary" id="addBtn">Add Note</button>
      </div>
    </div>
    <hr style="border-top: 1px solid rgb(232, 221, 221);margin-top:3%;">
    <h1 id="Your">Your Notes</h1>
    <hr style="border-top: 1px solid rgb(232, 221, 221);">
    <div id="notes" class="row container-fluid"> </div>

    <div id="nosearchres" class="row container-fluid" style="display: none;color:grey">No Search Results Found</div>
</div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

  <div class="container">
    <!-- Modal for About Us -->
    <div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" style="color:orange"><b>NotesTaker - About Us</b></h2>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <p>
            <h2><i>Capture ideas when inspiration strikes. Find information fast. Share notes with anyone.</i></h2>
            <br />

            <span style="color:rgb(38, 36, 36)"><b>Use NotesTaker as the place you put everything … Don’t ask yourself
                which device it’s on—it’s in NotesTaker</b></span>
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Modal for contact us-->
    <div class="modal fade" id="myModal2" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" style="color:purple"><b>NotesTaker - Contact Us</b></h2>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <p>
            <h2><i>When it comes to taking all manner of notes and getting work done, NotesTaker is an indispensable
                tool</i></h2><br />

            <span style="color:rgb(38, 36, 36)"><b>NotesTaker is a Personal App currently owned by SodaInMind .U can
                reach out to us by clicking <a href="https://sodainmind.com/contact/">here</a></span>
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Delete Note Modal -->
<div class="modal fade" id="myModal3">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Delete the Note ?</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                You're going to delete a note <br/>Are you sure ?
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="modal" data-target="#myModal4" onclick="deleteNote(this.id)">Delete</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" >Cancel</button>
            </div>
        </div>
    </div>
  </div>
  
  
  <!-- Acknowledgement for delete note Modal -->
  <div class="modal fade" id="myModal4">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Modal body -->
            <div class="modal-body">
               <h4 class=""> Note Succesfully Deleted</h4>                                   
                <button type="button" class="btn btn-primary btn-sm float-right" data-dismiss="modal" >Ok</button>
            </div>
        </div>
    </div>
  </div>

 <script>
    console.log("Welcome to notes app. This is app.js");
    showNotes();

    function modeconf() {
      if (localStorage.mode == undefined) { darktheme = false }
      else {
        if (localStorage.mode == 'bright') { darktheme = true }
        else { darktheme = false }
      }
      modechange()
    }

    // If user adds a note, add it to the localStorage
    let addBtn = document.getElementById("addBtn");
    addBtn.addEventListener("click", function (e) {
      let addTxt = document.getElementById("addTxt");
      let addTitle = document.getElementById("addTitle");
      let notes = localStorage.getItem("notes");
      
      // Validation
      aT=addTitle.value
      addTitle.value=aT.replaceAll("<","&lt;")
      aT=addTitle.value
      addTitle.value=aT.replaceAll(">","&gt;")
      T=addTxt.value
      addTxt.value=T.replaceAll("<","&lt;")
      T=addTxt.value
      addTxt.value=T.replaceAll(">","&gt;")
      
      if (notes == null) {
        notesObj = [];
      } else {
        notesObj = JSON.parse(notes);
      }

      let notes_merge = {
        Title: addTitle.value,
        Txt: addTxt.value
      }

      notesObj.unshift(notes_merge);
      localStorage.setItem("notes", JSON.stringify(notesObj));

      addTxt.value = "";
      addTitle.value = "";
      showNotes();

      // dismissable alert message for successful note submission
      document.getElementById("addednotes").innerHTML = `
      <div class="alert alert-success alert-dismissible fade show container-fluid" role="alert" style="position:absolute;">
      <strong>Note Added !</strong> Your Note has been succesfully added
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
      </button>
      </div>`
    });

    // Function to show elements from localStorage
    function showNotes() {
      let notes = localStorage.getItem("notes");
      if (notes == null) {
        notesObj = [];
      } else {
        notesObj = JSON.parse(notes);
      }

      let html = "";
      notesObj.forEach(function (element, index) {
        if (element.Title == '') { element.Title = 'An Empty Note'; }
        if (element.Txt == '') { element.Txt = 'This text is Empty -> Please Add Some text....'; }

        html += `
              <div class="noteCard my-2 mx-2 card" style="width: 18rem;">
                      <div class="card-body">
                          <h5 class="card-title">${index + 1}. ${element.Title}</h5>
                          <p class="card-text"> ${element.Txt}</p>                          
                          <button id="${index}" class="btn btn-primary" data-toggle="modal" data-target="#myModal3">Delete Note</button>
                      </div>
                  </div>`;
      });
      let notesElm = document.getElementById("notes");
      if (notesObj.length != 0) {
        notesElm.innerHTML = html;
      } else {
        notesElm.innerHTML = `<span style="color:grey">Nothing to show! Use "Add a Note" section above to add notes.</span>`;
      }
    }

    // Function to delete a note
      // Passing data from click to modal
      document.getElementById('.delmodcall').addEventListener('click',function(e){
          id=e.target.id
          console.log(e.target.id)
          a=document.getElementById('delnotebtn')
          a.setAttribute('onclick',`deleteNote(${id}})`)
          console.log(a)
      })

    function deleteNote(index) {
        let notes = localStorage.getItem("notes");
        if (notes == null) {
          notesObj = [];
        } else {
          notesObj = JSON.parse(notes);
        }

        notesObj.splice(index, 1);
        localStorage.setItem("notes", JSON.stringify(notesObj));
        showNotes();      
    }

     //Search Matching Notes
     let search = document.getElementById('searchTxt');
    search.addEventListener("input", function (e) {
      let inputVal = search.value.toLowerCase();
      let noteCards = document.getElementsByClassName('noteCard');
      results=false
      Array.from(noteCards).forEach(function (element) {
        let cardTxt = element.getElementsByTagName("p")[0].innerText.toLowerCase();
          if (cardTxt.includes(inputVal)) {
          element.style.display = "block";
          results=true
        }
        else {
          element.style.display = "none";          
        }
      })
        if(results==false && document.getElementById("notes").innerHTML != `<span style="color:grey">Nothing to show! Use "Add a Note" section above to add notes.</span>`){
          document.getElementById("nosearchres").style.display="block"
        }
        else{
          document.getElementById("nosearchres").style.display="none"
      }
    })

    //To stop search from reloading ,as it refreshes page and fetched search results are disspeared
    document.getElementById('search').addEventListener("click", function (e) {
      e.preventDefault()
    })

    function modechange() {
      if (darktheme == false) {
        localStorage.setItem('mode', 'dark')
        document.querySelector('body').className = "darktheme"
        document.getElementById("Welcome").className = "darkcolor"
        document.getElementById("Your").className = "darkcolor"
        document.getElementById("modebtn").src = "light.png"
        document.querySelector('nav').setAttribute('class', "navbar navbar-expand-lg navbar-dark bg-primary");
        document.getElementById("search").setAttribute('class', "btn btn-outline-light my-2 my-sm-0")
        darktheme = true
      }
      else {
        localStorage.setItem('mode', 'bright')
        document.querySelector('body').classList.remove("darktheme")
        document.getElementById("Welcome").classList.remove("darkcolor")
        document.getElementById("Your").classList.remove("darkcolor")
        document.querySelector('nav').setAttribute('class', "navbar navbar-expand-lg navbar-dark bg-dark")
        document.getElementById("search").setAttribute('class', "btn btn-outline-success my-2 my-sm-0")
        document.getElementById("modebtn").src = "dark.png"
        darktheme = false
      }
    }
// fixes done: more-precise placeholder of search, updated hr tag's color so it gets visible in both modes,fixed navbar in dark mode not being collapsable,fixed the line "No notes please add one" wasnt being visible in dark mode,save ur theme preference & serve accordingly as every time the website is loaded,deleting/adding notes alerts,search event handled,latest note displays first,input validation
// Fixed dismissable success message making it absolute,Acknowledgement for no search results-"No search Results found",
/*
    Further Features:
    2. Mark a note as Important
    3. Separate notes by user
    4. Sync and host to web server
*/
  </script>

</body>

</html>
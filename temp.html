<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Notes App</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <style>
    #aboutus {
      cursor: pointer;
    }

    #modebtn:hover {
      border-radius: 10px 10px;
      box-shadow: 2px 2px 5px 3px #888888;
      cursor: pointer;
    }

    .darktheme {
      background-color: rgb(29, 28, 28);
    }

    .darkcolor {
      color: white;
    }

    /* this will sync our website size as if we were viewing it in 75% zoom when 100% is the zoom*/
    .zoom {
      zoom: 0.75;
    }

    .zoom2 {
      zoom: 0.88;
    }

    /* Hide scrollbar,as clicking on modal was making scrollbar disappear for that brief moment and this was causing the page to shift right-left */
    html::-webkit-scrollbar {
      display: none;
    }

    html {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    .alert {
      height: 15%;
      width: 24%;
      margin-left: 35% !important;
      transform: matrix();
      box-shadow: 2px 2px #000000;
    }

    .ErrorMsg {
      color: red;
      font-size: 12px;
      font-weight: 700;
    }

    @media only screen and (max-width:540px) and (min-width:400px) {
      .alert {
        height: 13%;
        width: 45%;
        margin-left: 30% !important;
      }

      .w-75 {
        width: 100% !important;
      }

      .noteCard {
        width: 14rem !important;
      }
      .noteCard .btn{width: 60% !important;font-size:13px;margin:2px}
    }

    @media only screen and (max-width:576px) and (min-width:400px) {
      .modal-dialog {
        position: relative !important;
        width: 300px !important;
        margin: auto !important;
        pointer-events: none !important;
      }
    }

    @media only screen and (max-width:400px) {
      .alert {
        height: 13%;
        width: 55%;
        margin-left: 30% !important;
      }

      .w-75 {
        width: 100% !important;
      }

      .noteCard {
        width: 12rem !important;
      }

      .modal-dialog {
        position: relative !important;
        width: 300px !important;
        margin: auto !important;
        pointer-events: none !important;
      }
      .noteCard .btn{width: 70% !important;font-size:13px;margin:2px}
    }

    @media only screen and (max-width:330px) {
      .noteCard {
        width: 70% !important;
      }

      .modal-dialog {
        position: relative !important;
        width: 300px !important;
        margin: auto !important;
        pointer-events: none !important;
      }
    }

    [contenteditable]:focus {
      outline: 0px solid transparent;
      border: 0px solid transparent;
      border-radius: .25rem;
      background-color: #ced4da;
    }
  </style>
</head>

<body onload="modeconf()">
  <div class="zoom">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">Notes Taker</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" id="aboutus" data-toggle="modal" data-target="#myModal"> About Us </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" id="aboutus" data-toggle="modal" data-target="#myModal2"> Contact Us </a>
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" id="searchTxt" type="search" placeholder="Your Note's Title"
            aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit" id="search">Search</button>
        </form>
      </div>
    </nav>
  </div>

  <!-- success message -->
  <div id="addednotes" class="zoom"></div>

  <div class="container pt-5 my-2 zoom">
    <h1 class="d-inline" id="Welcome">
      <span>Welcome To Notes Taker</span>
      <img type="button" src="dark.png" class="float-right" id="modebtn" width="5%" onclick="modechange()">
    </h1>

    <div class="card w-75 p-2 my-4">
      <div class="form-group">
        <h5 class="card-title mx-2 my-3 mx-3">Title*</h5>
        <input type="text" class="mx-3 form-control addTitle" id="addTitle" style="width: 90%;"
          placeholder="Add Title Here">
        <div id="TitleErr" class="ErrorMsg" style="position: absolute;left:25px"></div>
      </div>

      <div class="card-body">
        <h5 class="card-title">Description</h5>
        <div class="form-group">
          <textarea class="form-control" id="addTxt" rows="2" placeholder="Add Description Here"></textarea>
          <div id="TxtErr" class="ErrorMsg" style="position: absolute;left:25px"></div>
        </div>
        <button class="btn btn-primary my-2" id="addBtn">Add Note</button>
      </div>
    </div>

    <hr style="border-top: 1px solid rgb(232, 221, 221);margin-top:3%;">
    <h1 id="Your">Your Notes</h1>
    <hr style="border-top: 1px solid rgb(232, 221, 221);">
    <div id="notes" class="row container-fluid"> </div>

    <div id="nosearchres" class="row container-fluid" style="display: none;color:grey">No Search Results Found</div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

  <div class="container zoom">
    <!-- Modal for About Us -->
    <div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" style="color:orange"><b>NotesTaker - About Us</b></h2>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <p>
            <h2><i>Capture ideas when inspiration strikes. Find information fast. Share notes with anyone.</i></h2>
            <br />

            <span style="color:rgb(38, 36, 36)"><b>Use NotesTaker as the place you put everything … Don’t ask yourself
                which device it’s on—it’s in NotesTaker</b></span>
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container zoom">
    <!-- Modal for contact us-->
    <div class="modal fade" id="myModal2" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" style="color:purple"><b>NotesTaker - Contact Us</b></h2>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <p>
            <h2><i>When it comes to taking all manner of notes and getting work done, NotesTaker is an indispensable
                tool</i></h2><br />

            <span style="color:rgb(38, 36, 36)"><b>NotesTaker is a Personal App currently owned by SodaInMind .U can
                reach out to us by clicking <a href="https://sodainmind.com/contact/">here</a></span>
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Note Modal -->
  <div class="modal fade zoom" id="myModal3">
    <div class="modal-dialog modal-dialog-top modal-sm">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Delete the Note ?</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <!-- Modal body -->
        <div class="modal-body">
          You're about to delete a note <br />Are you sure ?
        </div>
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" id="delnotebtn" class="btn btn-primary" data-dismiss="modal" onclick="">Delete</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    console.log("Welcome to notes app. This is app.js");
    showNotes();

    // Mode setting for page reloads
    function modeconf() {
      if (localStorage.mode == undefined) { darktheme = false }
      else {
        if (localStorage.mode == 'bright') { darktheme = true }
        else { darktheme = false }
      }
      modechange()
      prereqdel()
      noteseditable()
    }

    //validate inputs
    function onvalidate() {
      title = document.getElementById('addTitle')
      text = document.getElementById('addTxt')
      titleErr = document.getElementById('TitleErr')
      textErr = document.getElementById('TxtErr')

      titleErr.innerHTML = ""
      titleErr.style.display = "block"
      textErr.innerHTML = ""
      textErr.style.display = "block"

      if (title.value.length == 0 || !title.value.replace(/\s/g, '').length) {
        titleErr.innerHTML = "Please add a Title"
        title.style.border = "1px solid red"
      }
      else {
        titleErr.innerHTML = "";
        title.style.border = "1px solid #ced4da"
      }

      if (text.value.length > 0 && text.value.length < 10) {
        textErr.innerHTML = "If you add a Description,please add atleast 10 Characters"
        text.style.border = "1px solid red"
      }
      else {
        textErr.innerHTML = ""
        text.style.border = '1px solid #ced4da'
      }
    }


    // If user adds a note, add it to the localStorage
    let addBtn = document.getElementById("addBtn");
    addBtn.addEventListener("click", function (e) {
      onvalidate()
      let addTxt = document.getElementById("addTxt");
      let addTitle = document.getElementById("addTitle");
      let notes = localStorage.getItem("notes");

      if (addTitle.value == "" || !addTitle.value.replace(/\s/g, '').length || text.value.length > 0 && text.value.length < 10) {
        document.getElementsByClassName('')
      }
      else {
        // Validation
        aT = addTitle.value
        addTitle.value = aT.replaceAll("<", "&lt;")
        aT = addTitle.value
        addTitle.value = aT.replaceAll(">", "&gt;")
        T = addTxt.value
        addTxt.value = T.replaceAll("<", "&lt;")
        T = addTxt.value
        addTxt.value = T.replaceAll(">", "&gt;")

        if (notes == null) {
          notesObj = [];
        } else {
          notesObj = JSON.parse(notes);
        }

        let notes_merge = {
          Title: addTitle.value,
          Txt: addTxt.value
        }

        notesObj.unshift(notes_merge);
        localStorage.setItem("notes", JSON.stringify(notesObj));

        addTxt.value = "";
        addTitle.value = "";
        showNotes();
        // dismissable alert message for successful note submission
        document.getElementById("addednotes").innerHTML = `
      <div class="alert alert-success alert-dismissible mx-auto" role="alert" style="position:fixed;z-index:1;top:24px;opacity:0.98">
        <strong>Note Added !</strong> Your Note has been succesfully added
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
      </div>`
        prereqdel();noteseditable();
        document.getElementById('TitleErr').innerHTML = ""
        document.getElementById('TxtErr').innerHTML = ""
      }
    });

    // Function to show elements from localStorage
    function showNotes() {
      let notes = localStorage.getItem("notes");
      if (notes == null) {
        notesObj = [];
      } else {
        notesObj = JSON.parse(notes);
      }

      let html = "";
      notesObj.forEach(function (element, index) {
        html += `
              <div class="noteCard my-2 mx-2 card zoom2" style="width: 18rem;">
                      <div class="card-body">
                          <h5 class="card-title">${index + 1}.<span class="notetitle" style="padding:3px;margin-left:2px"> ${element.Title}</span></h5><hr/>
                          <p class="card-text" style="min-height:22px;padding:3px;"> ${element.Txt}</p>
                          <div class='UpdateErr pt-0' style='position:absolute;font-size:13px;color:Red;font-weight:700;bottom:80px'>sassy</div>
                          <button id="Update${index}" class="btn btn-primary UpdateBtn mt-4" onclick="UpdateNote(event)">Update Note</button>
                          <button id="${index}" class="btn btn-primary delmodcall mt-4" data-toggle="modal" data-target="#myModal3">Delete Note</button>
                      </div>
                  </div>`;
      });
      let notesElm = document.getElementById("notes");
      if (notesObj.length != 0) {
        notesElm.innerHTML = html;
      } else {
        notesElm.innerHTML = `<span style="color:grey">Nothing to show! Use "Add a Note" section above to add notes.</span>`;
      }
      prereqdel();noteseditable();
    }

    // Function to delete a note
    // Passing data from click to modal
    function prereqdel() {
      delbtn = document.getElementsByClassName('delmodcall')
      arrdelbtn = Array.from(delbtn)
      arrdelbtn.forEach(function (item) {
        item.addEventListener("click", function (e) {
          id = e.target.id
          a = document.getElementById('delnotebtn')
          a.setAttribute('onclick', `deleteNote(${id})`)
        }
        )
      })
    }

    function deleteNote(index) {
      let notes = localStorage.getItem("notes");
      if (notes == null) {
        notesObj = [];
      } else {
        notesObj = JSON.parse(notes);
      }
      notesObj.splice(index, 1);
      localStorage.setItem("notes", JSON.stringify(notesObj));
      showNotes(); prereqdel();noteseditable();
    }

    //Search Matching Notes
    let search = document.getElementById('searchTxt');
    search.addEventListener("input", function (e) {
      let inputVal = search.value.toLowerCase();
      let noteCards = document.getElementsByClassName('noteCard');
      results = false
      Array.from(noteCards).forEach(function (element) {
        let cardTxt = element.getElementsByClassName("notetitle")[0].innerText.toLowerCase();
        if (cardTxt.includes(inputVal)) {
          element.style.display = "block";
          results = true
        }
        else {
          element.style.display = "none";
        }
      })

      // To display no search result found
      if (results == false && document.getElementById("notes").innerHTML != `<span style="color:grey">Nothing to show! Use "Add a Note" section above to add notes.</span>`) {
        document.getElementById("nosearchres").style.display = "block"
      }
      else {
        document.getElementById("nosearchres").style.display = "none"
      }
    })

    //To stop search from reloading ,as it refreshes page and fetched search results are disspeared
    document.getElementById('search').addEventListener("click", function (e) {
      e.preventDefault()
    })

    // mode configurations
    function modechange() {
      if (darktheme == false) {
        localStorage.setItem('mode', 'dark')
        document.querySelector('body').className = "darktheme"
        document.getElementById("Welcome").className = "darkcolor"
        document.getElementById("Your").className = "darkcolor"
        document.getElementById("modebtn").src = "light.png"
        document.querySelector('nav').setAttribute('class', "navbar navbar-expand-lg navbar-dark bg-primary");
        document.getElementById("search").setAttribute('class', "btn btn-outline-light my-2 my-sm-0")
        darktheme = true
      }
      else {
        localStorage.setItem('mode', 'bright')
        document.querySelector('body').classList.remove("darktheme")
        document.getElementById("Welcome").classList.remove("darkcolor")
        document.getElementById("Your").classList.remove("darkcolor")
        document.querySelector('nav').setAttribute('class', "navbar navbar-expand-lg navbar-dark bg-dark")
        document.getElementById("search").setAttribute('class', "btn btn-outline-success my-2 my-sm-0")
        document.getElementById("modebtn").src = "dark.png"
        darktheme = false
      }
    }

    //Making all notes editable
    function noteseditable(){
    Array.from(document.getElementsByClassName('noteCard')).forEach(function(e){
      e.getElementsByClassName('card-text')[0].contentEditable=true
      e.getElementsByClassName('notetitle')[0].contentEditable=true
    })
  }
    
    //Updating Notes
    function UpdateNote(e){
    index=e.target.id
    index=parseInt(index.replace('Update',''))

    newtitle=document.getElementsByClassName('noteCard')[index].getElementsByClassName('notetitle')[0].innerText
    newtext=document.getElementsByClassName('noteCard')[index].getElementsByClassName('card-text')[0].innerText
    
    oldata=JSON.parse(localStorage.getItem("notes"));

    oldtitle=String.raw`${oldata[index].Title}`
    oldtext=String.raw`${oldata[index].Txt}`
    if(oldtitle==newtitle && oldtext==newtext){
      console.log('match')
      Array.from(document.getElementsByClassName('UpdateErr'))[index].innerText='Please edit your Note before Updating it'
      
      document.createTextNode('Please edit your Note before Updating it')
      document.body.insertBefore('#UpdateErr',)

      // Array.from(document.getElementsByTagName('body'))[0].innerText='PLEASE'
      console.log(Array.from(document.getElementsByClassName('UpdateErr'))[index].innerText='Please edit your Note before Updating it')
    }
    else{
      console.log('nomatch')
      Array.from(document.getElementsByClassName('UpdateErr'))[index].innerHTML=''
      console.log(Array.from(document.getElementsByClassName('UpdateErr'))[index].innerHTML='')
    }

    oldata[index]={
      Title: newtitle,
      Txt: newtext
    }

    localStorage.setItem("notes",JSON.stringify(oldata))    
    
    document.getElementById("addednotes").innerHTML = `
      <div class="alert alert-dark alert-dismissible mx-auto" role="alert" style="position:fixed;z-index:1;top:24px;opacity:0.98;color:black">
        <strong>Note Updated !</strong> Your Note has been succesfully updated
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
      </div>`
      showNotes();prereqdel();noteseditable();
  }

// fixes done: more-precise placeholder of search, updated hr tag's color so it gets visible in both modes,fixed navbar in dark mode not being collapsable,fixed the line "No notes please add one" wasnt being visible in dark mode,save ur theme preference & serve accordingly as every time the website is loaded,deleting/adding notes alerts,search event handled,latest note displays first,input validation
// Fixed dismissable success message making it absolute,Acknowledgement for no search results-"No search Results found",modals for delete,scrollbar toggling handled,size setting of different element,search made according to title,validations for input,responsiveness handled
// handled input validation if only spaces/tabs are entered,removed the delete acknowlegement modal,altered size/display position of delete modal,error messages,labels & placeholder's display text changes,modals/dismissable-messages made responsive,Update Notes Functionality added
    /*
    Further Features:
    2. Mark a note as Important
    3. Separate notes by user
    4. Sync and host to web server
    */
  </script>

</body>

</html>